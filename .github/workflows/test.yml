name: CI

# Controls when the workflow will run
on:
  pull_request:
    branches: [ "*" ]
  push:
    branches: [ "*" ]
    tags: [ "v*" ]

env:
  REPO_NAME: ${{ github.event.repository.name }}
  BRANCH_OR_TAG: ${{  github.ref_name }}

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  validate:
    name: Validate code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: checks the files
        run: |
          echo Checking the files!

  deploy_prod:
    name: Uploads to S3
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/tags/v') }}
    needs: validate

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Copy files to the test website with the AWS CLI
        run: |
          echo aws s3 cp templates s3://bootstrap-awss3cloudformationbucket-xxxyyy/$REPO_NAME/$BRANCH_OR_TAG/ --recursive


